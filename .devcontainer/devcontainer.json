// For format details, see https://aka.ms/devcontainer.json. For config options, see the
// README at: https://github.com/devcontainers/templates/tree/main/src/ubuntu
{
	"name": "Ubuntu",
	// Or use a Dockerfile or Docker Compose file. More info: https://containers.dev/guide/dockerfile
	"image": "mcr.microsoft.com/devcontainers/base:jammy",
	"features": {
		"ghcr.io/devcontainers/features/azure-cli:1": {},
		"ghcr.io/devcontainers/features/node:1": {},
		"ghcr.io/devcontainers/features/python:1": {},
		"ghcr.io/rocker-org/devcontainer-features/quarto-cli:1": {},
		"ghcr.io/rocker-org/devcontainer-features/r-apt:0": {},
		"ghcr.io/rocker-org/devcontainer-features/r-packages:1": {},
		"ghcr.io/rocker-org/devcontainer-features/rstudio-server:0": {},
		"ghcr.io/devcontainers-contrib/features/poetry:2": {},
		"ghcr.io/devcontainers-contrib/features/ruff:1": {},
		"ghcr.io/devcontainers-contrib/features/starship:1": {},
		"ghcr.io/dhoeric/features/google-cloud-cli:1": {},
		"ghcr.io/stuartleeks/dev-container-features/azure-cli-persistence:0": {},
		"ghcr.io/joshuanianji/devcontainer-features/gcloud-cli-persistence:1": {},
		"ghcr.io/nikobockerman/devcontainer-features/poetry-persistent-cache:1": {},
		"ghcr.io/rocker-org/devcontainer-features/r-history:0": {},
		"ghcr.io/stuartleeks/dev-container-features/shell-history:0": {},
		"ghcr.io/devcontainers/features/docker-in-docker:2": {}
	},
	// Ports & Server ----------------------------------------------------------------------------
	// start RStudio Server process in container
	"postAttachCommand": {
		"rstudio-start": "rserver"
	},
	// https://containers.dev/implementors/json_reference/#port-attributes
	"forwardPorts": [
		8787
	],
	"portsAttributes": {
		"8787": {
			"label": "RStudio IDE",
			"requireLocalPort": true, // defaults to false
			"onAutoForward": "ignore" // defaults to notify
		}
	},
	// Lifecycle Scripts ----------------------------------------------------------------------------
	// https://containers.dev/implementors/json_reference/#lifecycle-scripts
	// run after the container is created.
	"postCreateCommand": "sh ./.devcontainer/postCreateCommand.sh",
	// run every time the container starts
	"postStartCommand": "sh ./.devcontainer/postStartCommand.sh",
	// Configure tool-specific properties
	"workspaceFolder": "/workspaces/${localWorkspaceFolderBasename}/",
	"customizations": {
		"vscode": {
			"extensions": [
				// General
				"eamodio.gitlens",
				"mhutchie.git-graph",
				"knisterpeter.vscode-commitizen",
				"ms-vscode-remote.vscode-remote-extensionpack",
				"ms-vsliveshare.vsliveshare",
				"github.copilot",
				"github.copilot-chat",
				"visualstudioexptteam.vscodeintellicode",
				// R
				"quarto.quarto",
				"REditorSupport.r",
				// Python
				"ms-python.python",
				"ms-toolsai.jupyter",
				"charliermarsh.ruff",
				"tamasfe.even-better-toml",
			],
			"settings": {
				"editor.codeActionsOnSave": {
					"source.fixAll": "always",
					"source.organizeImports": "always"
				},
				"editor.formatOnSave": true,
				"[python]": {
					"editor.defaultFormatter": "charliermarsh.ruff"
				},
				"[toml]": {
					"editor.formatOnSave": false
				},
				"editor.rulers": [
					100
				],
				"files.autoSave": "onFocusChange",
				"mypy-type-checker.importStrategy": "fromEnvironment",
				"python.defaultInterpreterPath": "/opt/greenwashing-env/bin/python",
				"python.terminal.activateEnvironment": false,
				"python.testing.pytestEnabled": true,
				"ruff.importStrategy": "fromEnvironment"
			}
		}
	}
	// Uncomment to connect as root instead. More info: https://aka.ms/dev-containers-non-root.
	// "remoteUser": "root"
}